"use strict";$(function(){function e(e,a){var n=$(a).parent().find(".Num").data("max"),c=$(a).parent().find(".Num").val(),t=$(a).parent().parent().parent().find(".setprice").data("price");"add"==e?n<=++c&&(c=n):"sub"==e&&--c<=1&&(c=1),$(a).parent().find(".Num").val(c),$(a).parent().parent().next().find("strong.colore93").html('<span class="rmb colore93">¥</span>'+parseInt(t*c).toLocaleString()+"元"),$(a).parent().parent().parent().find(".checkBox").is(":checked")&&i()}function i(){var n=0,c=0,t=0;$("table .Num").each(function(e,a){$(a).parent().parent().parent().parent().find(".checkBox").is(":checked")&&(t++,n+=1*$(a).val(),c+=$(a).val()*$(a).parent().parent().parent().parent().find(".setprice").data("price"))}),$("body").find(".cartPrice .kindsum").html("商品数量总计："+t+"件"),$("body").find(".cartPrice .allsum").html("包装数量总计："+n),$("body").find(".totalPriceBottom strong").html(parseInt(c).toLocaleString()+".00")}$.post("../api/showcar.php",{name:getCookie("name")},function(e){var a=JSON.parse(e);console.log(a);var n=0,c=0,t=0,i=a.map(function(e,a){return n=a,c+=1*e.buynum,t+=e.buynum*e.price,'<tbody data-id="'+e.goodid+'">\n                        <tr class="addChecked" name="cartRow" productid="">\n                            <td>\n                                <input class="checkBox" id="choseItem" type="checkbox" checked="">\n                            </td>\n                            <td width="97" valign="top">\n                                <div class="cartPic fl padRight15">\n                                    <a href="#" target="_blank"><img src="../images/'+e.img+'" width="80" height="80"></a>\n                                </div>\n                            </td>\n                            <td valign="top">\n                                <div class="cartNames fl">\n                                    <p class="namePro"><a href="#" target="_blank">'+e.detail+'</a></p>\n                                </div>\n                                <div class="cartNames fl" style="overflow:visible">\n                                    <p class="namePro color999 pad45">        \n                                    </p>\n                                </div>\n                            </td>\n                            <td valign="top">中国大陆</td>\n                            <td valign="top" class="setprice" data-price="'+e.price+'"><span class="rmb">¥</span>'+parseInt(e.price).toLocaleString()+'</td>\n                            <td valign="top">\n                                <div class="countNum clearfix">\n                                    <div class="cPlus fl" action="decrease">-</div>\n                                    <div class="cInput fl">\n                                        <input data-max="'+e.goodnum+'" class="Num" type="text" value="'+e.buynum+'">\n                                    </div>\n                                    <div class="cMinus fl" action="increase">+</div>\n                                </div>   \n                            </td>\n                            <td valign="top">\n                                <strong class="colore93">\n                                    <span class="rmb colore93">¥</span>\n                                        '+parseInt(e.price*e.buynum).toLocaleString()+'元\n                                </strong>\n                            </td>\n                            <td valign="top">\n                                <a href="###" class="del" name="deleteRow">删除</a>\n                            </td>\n                        </tr>\n                    </tbody>'}),o='<div class="cartAno">\n                        <div class="ano01 fl">\n                            <input name="choseAll" type="checkbox" id="choseAll" checked=""><label for="choseAll">全选</label>\n                        </div>\n                        <div class="ano02 fl delSp">\n                            <a href="###">删除选中商品</a>\n                        </div>\n                    </div>\n                    <p class="kindsum" data-sum="'+(n+1)+'">商品数量总计：'+(n+1)+'件</p>\n                    <p class="allsum" data-sum="'+c+'">包装数量总计：'+c+'</p>\n                    <p>返利库币：0库币</p>\n                    <p class="totalPriceBottom">商品金额总计（不含税金和运费）：<span class="rmb"></span><strong>'+parseInt(t).toLocaleString()+'.00</strong></p>\n                    <p class="clearfix">\n                        <a href="../index.html" class="fl a01" target="_blank">继续购物</a>\n                        <a href="javascript:;" class="fr a02">立即结算</a>\n                    </p>';$(".carTable").append(i),$(".cartPrice").html(o)}),$(".username").text(getCookie("name")),$("main_top a").click(function(){confirm("你确定要退出用户吗？")&&(removeCookie("name"),location.href="list.html")}),$("thead").on("click","#choseAll,lable",function(){$(this).prop("checked")?($("table").find(".checkBox").prop("checked",!0),$(".cartPrice").find("#choseAll").prop("checked",!0)):($("table").find(".checkBox").prop("checked",!1),$(".cartPrice").find("#choseAll").prop("checked",!1)),i()}),$("table").on("click",".cPlus",function(){e("sub",this)}),$("table").on("click",".cMinus",function(){e("add",this)}),$("table").on("click",".checkBox",function(){$("body").find(".checkBox").prop("checked")?($("table").find("#choseAll").prop("checked",!0),$(".cartPrice").find("#choseAll").prop("checked",!0)):($("table").find("#choseAll").prop("checked",!1),$(".cartPrice").find("#choseAll").prop("checked",!1)),i()}),$(".cartPrice").on("click","#choseAll",function(){$(this).is(":checked")?$("body").find(".checkBox").prop("checked",!0):$("body").find(".checkBox").prop("checked",!1),$("body").find(".checkBox").prop("checked")?($("table").find("#choseAll").prop("checked",!0),$(".cartPrice").find("#choseAll").prop("checked",!0)):($("table").find("#choseAll").prop("checked",!1),$(".cartPrice").find("#choseAll").prop("checked",!1)),i()}),$(".cartPrice").on("click",".delSp",function(){$("body").find(".checkBox").each(function(e,a){if($(a).is(":checked")){var n=$(a).parent().parent().parent().data("id");$(a).parent().parent().parent().remove(),$.post("../api/delshop.php",{name:getCookie("name"),id:n},function(e){"yes"==e?location.href="shopcar.html":alert("系统删除失败")})}})}),$("table").on("click",".del",function(){var e=$(this).parent().parent().parent().data("id");confirm("你确定不要我了么")&&($(this).parent().parent().remove(),$.post("../api/delshop.php",{name:getCookie("name"),id:e},function(e){"yes"==e?location.href="shopcar.html":alert("系统删除失败")}))}),$(".cartPrice").on("click",".a02",function(){var c=0,e=$("table .checkBox");$("table .Num");(e.each(function(e,a){if($(a).is(":checked")){c++;var n=$(a).parent().parent().find(".Num");if(n.val()>n.data("max"));else!0}else c--}),0<c)?confirm("您不看看其他商品吗？目前您只买了"+$(".cartPrice").find(".totalPriceBottom strong").text()+"元")&&$(".lastshow").css("display","block"):console.log(222)}),$("table").on("input",".Num",function(){$(this).val()<1&&$(this).val(1),$(this).val()>$(this).data("max")&&$(this).val($(this).data("max")),i()})});